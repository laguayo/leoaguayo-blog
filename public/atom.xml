<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Leo Aguayo's Blog]]></title>
  <link href="http://leoaguayo.com/atom.xml" rel="self"/>
  <link href="http://leoaguayo.com/"/>
  <updated>2013-06-02T22:49:38-07:00</updated>
  <id>http://leoaguayo.com/</id>
  <author>
    <name><![CDATA[Leo Ivan Aguayo]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[BRZ Scraper]]></title>
    <link href="http://leoaguayo.com/blog/2013/05/24/brz-scraper/"/>
    <updated>2013-05-24T14:12:00-07:00</updated>
    <id>http://leoaguayo.com/blog/2013/05/24/brz-scraper</id>
    <content type="html"><![CDATA[<p><a href="#Day1">Day 1</a>
<a href="#Day2">Day 2</a>
<a href="#Day3">Day 3</a></p>

<div>I recently bought a new car.<i class='emoji smile'></i> But that’s not that awesome many people buy cars everyday, what makes this occasion special you ask? I bought a first year model made in collaboration by two amazing manufacturers, Toyota and Subaru. </div>


<div>
<img src="http://leoaguayo.com/images/brz-render-passenger.png" title="BRZ DGM Render" >
</div>


<p>It is the Subaru BRZ. Also known as Scion FR-S or Toyota GT-86 in Japan. Still not that great car just came out who cares&hellip;</p>

<p>Its special because it drove me to learn python and then I saw it as a rite of passage as a developer that I would write software to find my dream car.</p>

<p>It all started when saw this car a few months ago driving by on my commute to work, once as an FR-S and then as a BRZ so I became curious. I did my research and when I learned the backstory, twin cars made by two different companies, I was drawn. The opportuntity arrived that my significant other and I would need a new car, how convenient right? We start car shopping one thing led to another and we decided on getting the BRZ.</p>

<p>I started to shop around trying to find a good deal and learned this is a hard car to acquire at a fair price. Since it is it&rsquo;s first official year and it&rsquo;s so rare most dealers are marking up prices, or have no inventory.</p>

<p>Hmm what to do&hellip;I started to browse the internet and I noticed most Subaru dealers have the same site layout&hellip;Actually all individual Subaru dealers use the same layout.</p>

<p><img class="center" src="http://leoaguayo.com/images/subaru-dealer.png" width="485" height="300" title="Subaru Dealer" ></p>

<p>So my engineering mind went into hyperactive mode. I planned it out, I would just scrape all the Subaru dealers nearby or even in the same state and index all their inventory then just call up those that met my criteria and I would have my new car.</p>

<p>Also conveniently I wanted an excuse to learn a new language, a fellow colleague once commented, <blockquote><p>if you want to scrape a site use python, it’s really easy</p></blockquote>So I did, I&rsquo;ve never used python before so I decided why not learn python and find a new car all in one go and I did. This is where the coding starts, if you don&rsquo;t care skip ahead to the ending.</p>

<!-- more -->




<h2 id="Day1">Day 1: Simple scrape, BeautifulSoup and CLI</h2>


<p>I was surprised that I was able to learn basic python and the scraping library <a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> enough to put a script together in the span of 3 hours.</p>

<p>Some real python developers might cringe at the thought of this code and comments are appreciated as I am not versed in python best practices but I did my best in the short time I spent.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib2</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">printCars</span><span class="p">(</span> <span class="n">mylist</span> <span class="p">):</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
</span><span class='line'>      <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">stripped_strings</span><span class="p">:</span>
</span><span class='line'>              <span class="k">if</span> <span class="s">&#39;2013 Subaru BRZ&#39;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">string</span><span class="p">)</span>
</span><span class='line'>                      <span class="k">if</span> <span class="s">&quot;Limit&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span class='line'>                              <span class="k">print</span><span class="p">(</span><span class="s">&quot;+++++++++&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="k">elif</span> <span class="n">string</span> <span class="o">==</span> <span class="s">&#39;Satin White Pearl&#39;</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">Satin White Pearl&lt;============WHITE&#39;</span><span class="p">)</span>    
</span><span class='line'>              <span class="k">elif</span> <span class="n">string</span> <span class="o">==</span> <span class="s">&#39;6-Speed Automatic&#39;</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">6-Speed Automatic&lt;============AUTOMATIC&#39;</span><span class="p">)</span>    
</span><span class='line'>              <span class="k">elif</span> <span class="s">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">string</span><span class="p">)</span>                       
</span><span class='line'>              <span class="k">elif</span> <span class="n">string</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;VIN:&#39;</span><span class="p">,</span><span class="s">&#39;More&#39;</span><span class="p">,</span><span class="s">&#39;...&#39;</span><span class="p">,</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;Adjusted Price&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;Get ePrice&#39;</span><span class="p">,</span> <span class="s">&#39;Engine:&#39;</span><span class="p">,</span> <span class="s">&#39;H-4 cyl&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;Drive Line:&#39;</span><span class="p">,</span><span class="s">&#39;RWD&#39;</span><span class="p">,</span> <span class="s">&#39;Transmission:&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;Interior Color:&#39;</span><span class="p">,</span> <span class="s">&#39;Dark Gray&#39;</span><span class="p">,</span> <span class="s">&#39;Model Code:&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;Details&#39;</span><span class="p">,</span> <span class="s">&#39;2.9</span><span class="si">% F</span><span class="s">inancing&#39;</span><span class="p">,</span><span class="s">&#39;Watch Video&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;Compare&#39;</span><span class="p">,</span><span class="s">&#39;Compare Selected&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;View Details&#39;</span><span class="p">,</span> <span class="s">&#39;Manufacturer Offer:&#39;</span><span class="p">):</span>
</span><span class='line'>                      <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">string</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'>  
</span><span class='line'><span class="k">def</span> <span class="nf">getCars</span><span class="p">(</span> <span class="n">site</span> <span class="p">):</span>
</span><span class='line'>  <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">OPENING :&#39;</span> <span class="o">+</span> <span class="n">site</span>
</span><span class='line'>  <span class="n">page</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">site</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>  <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class='line'>  <span class="n">cars</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&quot;inv-type-new&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">printCars</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'>          
</span><span class='line'><span class="n">pages</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http://www.stevenscreeksubaru.com&#39;</span><span class="p">,</span> <span class="s">&#39;http://www.livermoresubaru.com&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s">&#39;http://www.subaruofoakland.com&#39;</span><span class="p">,</span> <span class="s">&#39;http://www.carlsensubaru.com&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s">&#39;http://www.marinsubaru.net&#39;</span><span class="p">,</span> <span class="s">&#39;http://www.albanysubaru.com&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">inventoryString</span> <span class="o">=</span> <span class="s">&#39;/new-inventory/index.htm&#39;</span>
</span><span class='line'><span class="n">modelParam</span> <span class="o">=</span> <span class="s">&#39;?model=BRZ&amp;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">subsite</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
</span><span class='line'>  <span class="n">site</span> <span class="o">=</span> <span class="n">subsite</span> <span class="o">+</span> <span class="n">inventoryString</span> <span class="o">+</span> <span class="n">modelParam</span>
</span><span class='line'>  <span class="n">getCars</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Output like this</p>

<div>
  <pre><code class='stripall'>Leos-MacBook-Pro-2:scraper leoaguayo$ ./scrapingWeather.py

OPENING :http://www.stevenscreeksubaru.com/new-inventory/index.htm?model=BRZ&amp;

2013 Subaru BRZ Premium
    $33,979
    6-Speed Automatic&lt;============AUTOMATIC
    Exterior Color:
    Sterling Silver
    DZB
    JF1ZCAB12D2609827

2013 Subaru BRZ Premium
    $32,078
    6-Speed Manual
    Exterior Color:
    Satin White Pearl&lt;============WHITE
    DZA
    JF1ZCAB17D1609912
    …

OPENING :http://www.livermoresubaru.com/new-inventory/index.htm?model=BRZ&amp;

2013 Subaru BRZ Limited
+++++++++
    MSRP
    $28,265
    6-Speed Manual
    Exterior Color:
    Sterling Silver
    DZE
    JF1ZCAC1XD1610017
    …</code></pre>
</div>


<p>So now I have a basic command line script I can run that will show me all the dealers with cars in their online inventory, useful to run a few times a day to see current inventory. Then I thought I should run this every so many minutes on a timer and then collect the data and send myself a notification, would be more useful.</p>

<p>Then I had a second thought this would be easier as a service or a running webapp independent of my local computer. Being an Java App Engine Developer, it would be easiest for me to port my python script to a python App Engine instance, that was the start of day 2.</p>

<h2 id="Day2">Day 2: Re-Learned App Engine, Webapp2, Jinja2 contemplated Django</h2>


<p>App Engine in Python was a completely massive task, especially since I was working on this project on my free time after and before work. I not only learned App Engine’s Python quirks I also gained a deeper understanding of python and its modules, classes, <a href="http://docs.python.org/2/tutorial/datastructures.html">list, sets and dictionary data structures.</a></p>

<p>I also learned about app engine framework webapp2 and how makes it easy to put together restful application fairly quickly. I then turned to use jinja2 as a quick markup template parser for generating content on the fly. Lastly I contemplated Django but I felt the learning curve was too steep, maybe I was wrong.</p>

<p>I planned out that I would have a 3 main classes, main.py would host all page navigation between the car list to the dealer list and editing each individual dealer. I would put all my data processing in my DataProcesses.py and last I would define all my entities in Entities.py so all schema changes were declared in one place.</p>

<p>I also made one parent layout.html page for jinja to inherit a general layout and then redfine the body content in each individual page. I played with bootstrap and data tables js to put the view together for each page.</p>

<p>I also re-factored most of my scraper code. Yet with all this learning curve I was able to pull something together fairly quickly, in one night I had a basic list of cars showing up on an index page loaded from the datastore. I ran the script manually because I didn&rsquo;t want to hit a bug running in task and potentially going over quota.</p>

<p>After this I began using Git Version Control. Most of this is documented in the <a href="https://github.com/laguayo/brz-scraps/">github repo</a>.</p>

<p>You can browse the code from the <a href="https://github.com/laguayo/brz-scraps/tree/0df03b9e49ce08fb7b25912a8f592ef382164ffb">initial commit</a> on github, it&rsquo;s not very pretty I made more robust changes in the later commits.</p>

<h2 id="Day3">Day 3: Put it all together this is what we have.</h2>


<p>After day 3 I had a list of dealers, a list of cars and some basic bootstrap and a few days later I added a js data table that could sort and filter the list of cars. Through the span of that week I would tweak little things here and there. I managed to get my task up and running.</p>

<p>A list of notable things</p>

<h4>I redid my parser after much debugging.</h4>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">parse_car</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">car_str</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span class='line'>      <span class="k">try</span><span class="p">:</span>
</span><span class='line'>          <span class="n">vin</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">car_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;hproduct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;data-vin&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="n">c</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">)</span>
</span><span class='line'>          <span class="n">check_car</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">())</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">check_car</span><span class="p">:</span>
</span><span class='line'>              <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Car already exist in db: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">vin</span><span class="p">)</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
</span><span class='line'>          <span class="n">media</span> <span class="o">=</span> <span class="n">car_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;media&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">car_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;url&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">car_str</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;value&#39;</span><span class="p">))</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">media</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">img_src</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">media</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;src&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">try</span><span class="p">:</span>
</span><span class='line'>              <span class="n">desc</span> <span class="o">=</span> <span class="n">car_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="n">desc_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span class='line'>              <span class="c"># desc_dict = dict(e.split(&#39;:&#39;) for e in description.split(&#39;,&#39;))</span>
</span><span class='line'>              <span class="n">k</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>              <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">dl</span><span class="o">.</span><span class="n">stripped_strings</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="p">(</span><span class="s">&#39;,&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;More&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">u&#39;</span><span class="se">\u2026</span><span class="s">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">):</span>
</span><span class='line'>                      <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>                      <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">desc_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span class='line'>          <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span class='line'>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Error Parsing Car line Description </span><span class="si">%s</span><span class="s"> &#39;</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">car_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">))</span>
</span><span class='line'>              <span class="k">return</span>
</span><span class='line'>          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Car Description dict </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">desc_dict</span><span class="p">)</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Transmission&#39;</span> <span class="ow">in</span> <span class="n">desc_dict</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">transmission</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_dict</span><span class="p">[</span><span class="s">&#39;Transmission&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Exterior Color&#39;</span> <span class="ow">in</span> <span class="n">desc_dict</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">ex_color</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_dict</span><span class="p">[</span><span class="s">&#39;Exterior Color&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Interior Color&#39;</span> <span class="ow">in</span> <span class="n">desc_dict</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">int_color</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_dict</span><span class="p">[</span><span class="s">&#39;Interior Color&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Mode Code&#39;</span> <span class="ow">in</span> <span class="n">desc_dict</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_dict</span><span class="p">[</span><span class="s">&#39;Model Code&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Stock #&#39;</span> <span class="ow">in</span> <span class="n">desc_dict</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">stock_num</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_dict</span><span class="p">[</span><span class="s">&#39;Stock #&#39;</span><span class="p">])</span>
</span><span class='line'>          <span class="k">if</span> <span class="s">&#39;Limit&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">trim</span> <span class="o">=</span> <span class="s">&#39;Limited&#39;</span>
</span><span class='line'>          <span class="k">else</span><span class="p">:</span>
</span><span class='line'>              <span class="n">c</span><span class="o">.</span><span class="n">trim</span> <span class="o">=</span> <span class="s">&#39;Premium&#39;</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">dealer</span> <span class="o">=</span> <span class="n">Dealer</span><span class="o">.</span><span class="n">gql</span><span class="p">(</span><span class="s">&#39;WHERE url = :1 &#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
</span><span class='line'>          <span class="bp">self</span><span class="o">.</span><span class="n">store_car</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
</span><span class='line'>      <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Error Parsing Car line </span><span class="si">%s</span><span class="s"> </span><span class="se">\n</span><span class="s">e = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">car_str</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span>
</span></code></pre></td></tr></table></div></figure>


<div>
<h4>Code Layout</h4>
    <div style="margin-left: 40px;"><ol>
        <li>File Structure</li>
        <ol>
            <li>Main.py - Main Request for loading jinja pages</li>
            <li>DataProcesses.py - basic store and processing data request classes</li>
            <li>Entities.py - Define all schema changes in one place for easy reference</li>
            <li>layout.html - main parent template for all jinja templates</li>
        </ol>
        <li> Libraries Used</li>
        <ol>
            <li><a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a></li>
            <li><a href="http://twitter.github.io/bootstrap/">twitter-bootstrap</a></li>
            <li><a href="http://www.datatables.net/">data tables</a></li>
            <li><a href="https://developers.google.com/appengine/docs/python/overview">App Engine</a></li>
        </ol>
    </ol>
    </div>
</div>


<h2>The End&#8230;</h2>


<p><a href="http://leoaguayo.com/images/brz-scraps.png"><img class="center" src="http://leoaguayo.com/images/brz-scraps.png" width="650" height="415" title="BRZ Scraper" ></a>
If you skipped to the end, quick note I made a program that looked up all dealerships inventory and scraped their inventory so I can look up dealers with my prefferred model and trim at atleast basic price, without markups.</p>

<p>After running the program for a week I started calling dealerships and even with all the code in the world, it wasn&rsquo;t enough. Some dealers would advertise MSRP online and then when you called or came in there would be a $5000 dollar markup sticker next to the car. So I let the program sit. I finally made a few plans to go down to Southern California to pick up my car in a few weeks once some dealers got their shipments in from Subaru.</p>

<p>Monday May 13th, after giving up for another 2 weeks, I was looking over my app engine logs and I noticed my script would hit a bug on one of the latest dealers I had added to the list, I fixed the bug re-deploy and boom their it was the car I was looking for sitting in a local dealer nearby. I called the dealer immediately and within the next few hours I was signing my life away.</p>

<h3>Last Day: Presentable tweaks</h3>


<p>After acquiring my car I knew I wanted to tell the world about my story so I added more user admin features to limit people who could access and edit parts of the site in case others want to add more dealers to the scraping script.</p>

<p>Github Page <a href="https://github.com/laguayo/brz-scraps">https://github.com/laguayo/brz-scraps</a></p>

<p>App Engine Link: <a href="http://brz-scraps.appspot.com">http://brz-scraps.appspot.com</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hi Everyone]]></title>
    <link href="http://leoaguayo.com/blog/2013/05/23/hi-everyone/"/>
    <updated>2013-05-23T12:02:00-07:00</updated>
    <id>http://leoaguayo.com/blog/2013/05/23/hi-everyone</id>
    <content type="html"><![CDATA[<p>Obligatory Hello World, how could you be a developer and not do hello world at the start of something.</p>
]]></content>
  </entry>
  
</feed>
